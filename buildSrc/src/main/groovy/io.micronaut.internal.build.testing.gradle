plugins {
    id 'java'
    id 'pl.droidsonroids.jacoco.testkit'
}

tasks.withType(Test).configureEach {
    def graalvmHome = providers.environmentVariable('GRAALVM_HOME')
            .orElse(providers.environmentVariable("JAVA_HOME"))
            .getOrElse("")
    useJUnitPlatform()
    inputs.property("GRAALVM_HOME", graalvmHome)
    predictiveSelection {
        enabled = micronautBuild.environment.isTestSelectionEnabled()
    }
    environment "GRAALVM_HOME", graalvmHome
    systemProperty "micronautVersion", libs.versions.micronaut.asProvider().get()
}

dependencies {
    testImplementation libs.groovy.core
    testImplementation libs.spock.core
    testImplementation libs.spock.junit4
}
